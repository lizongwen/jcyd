<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
</head>

<body>
	<script>

		//定义发布者
		const publisher = {}
		//定义订阅者
		const reserverA = {
			lister() {
				eventCenter.reserveFn('a', fn = function (res) {
					console.log('a事件发生了', res)
				})
				eventCenter.reserveFn('a', fn1 = function (res) {
					console.log('a事件发生了干其他事情', res)
				})
				eventCenter.reserveFn('b', function (res) {
					console.log('b事件发生了', res)
				})
			},
			unlister() {
				eventCenter.removeFn('a', fn1)
			}
		}

		//定义调度中心
		var eventCenter = {
			//定义目标缓存
			clientList: {},
			//定义发布方法
			publishFn() {
				const key = Array.prototype.shift.call(arguments),
					fns = this.clientList[key];
				if (!fns || fns.length === 0) {
					return false;
				}
				for (var i = 0, fn; fn = fns[i++];) {
					fn.apply(this, arguments);
				}
			},
			//定义订阅方法
			reserveFn(key, fn) {
				if (!this.clientList[key]) {
					this.clientList[key] = [];
				}
				this.clientList[key].push(fn)
			},
			//定义取消订阅
			removeFn(key, fn) {
				if (!this.clientList.hasOwnProperty(key)) {
					return false
				}
				let fns = this.clientList[key];
				if (!fn) {
					delete this.clientList[key];
					// fns && (fns.length = 0)
				} else {
					this.clientList[key] = fns.filter((item) => {
						return item != fn
					})
				}
			}
		}

		for (let i in eventCenter) {
			publisher[i] = eventCenter[i];
		}
		//开始订阅
		reserverA.lister();
		//取消订阅
		// reserverA.unlister()
		// console.log(eventCenter.clientList)

		//开始发布
		publisher.publishFn('a', { name: 'lzw' });
	</script>
</body>

</html>