<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
</head>

<body>
	<script>
		//定义发布者
		const publisher = {
			publish: function () {
				console.log("开始发布")
				EventCenter.publish('a', { result: '结果' }, this.callback);
			},
			callback: function (res) {
				console.log("发布结束",res)
			}
		}
		//定义订阅者
		const lister = {
			lister: function () {
				EventCenter.lister('a', this.doSomeThing);
			},
			doSomeThing: function (res) {
				console.log(res);
			}
		}
		//定义调度中心
		const EventCenter = {
			cache: {},
			publish: function () {
				let key = Array.prototype.shift.call(arguments), callback = Array.prototype.pop.call(arguments), fns = this.cache[key];
				callback.apply(this,arguments);
				for (var i = 0, fn; fn = fns[i++];) {
					fn.apply(this, arguments);
				}
			},
			lister: function (key, fn) {
				if (!this.cache[key]) {
					this.cache[key] = []
				}
				this.cache[key].push(fn);
			}
		}
		lister.lister();
		publisher.publish();
	</script>
</body>

</html>